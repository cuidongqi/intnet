;(function(oojs) {oojs.define({name:"BrandLoader",namespace:"dup.business.dan",deps:{url:"dup.common.utility.url",data:"dup.common.utility.data",dom:"dup.common.utility.dom"},hongData:null,isInBrandPattern:function(t){return!!/\/\/ecma\.bdimg\.com\/public03\/brand/.test(t)},load:function(t){this.hongData=t;var e=this.dom.g(this.danConfig.getWrapperId(t.id)),i=this.hongData.monitor_url,o=null;if(i&&i.length){var n=0,s=[],a=this;this.data.forEach(i,function(t){if(a.isInBrandPattern(t)){var e=a.url.queryToJson(t),i=e.url?decodeURIComponent(e.url):null,o=e.rate?parseFloat(e.rate):1;n+=o,s.push({url:i,rate:o,threshold:n})}});for(var r=100*Math.random(),d=0;d<s.length;d++){var l=s[d],h=100*l.threshold/n;if(h>r){o=l.url;break}}}o&&this.resWrapper(o,e)},resWrapper:function(t,e){if(e){this.wrapper=e;var i=e.get("RT_CONFIG"),o=this.danConfig.getWrapperId(this.hongData.id);i.id=o+"_canvas",this.dom.g(o)&&(this.dom.g(o).innerHTML='<div id="'+i.id+'"></div>'),e.set("RT_CONFIG",i),e.start(!1)}},config:function(t){this.hongData=t},isBrand:function(){var t=this.hongData.monitorUrlArray;if(t&&t.length){var e=!1,i=this;return this.data.forEach(t,function(t){i.isInBrandPattern(t)&&(e=!0)}),e}return!1},start:function(t){this.isBrand()&&this.load(t)}}),oojs.define({name:"config",namespace:"dup.business.dan",deps:{config:"dup.common.config",dom:"dup.common.utility.dom",style:"dup.common.utility.style",slot:"dup.business.slot",viewWatch:"dup.business.viewWatch",event:"dup.common.utility.event",monitor:"dup.business.monitor"},$config:function(){this.statusMap||(this.statusMap={})},setStatusMap:function(t,e){this.statusMap[t]=e},COMPILED:!1,VERSION_NUMBER:"",MATERIAL_CALLBACK_KEY:"BAIDU_DAN_materialCallback",AD_ELEMENTS_KEY:"BAIDU_DAN_adElements",CONTROL_BAR_HEIGHT:16,COLLAPSED_WIDTH:100,COLLAPSED_HEIGHT:100,MAX_ZINDEX:window.location.hostname.indexOf("baidu.com")>-1?249:2147483647,MIN_ZINDEX:window.location.hostname.indexOf("baidu.com")>-1?0:-2147483648,ID_ATTRIBUTE_NAME:"data-baidu-dan-id",POSITION_FIX_ATTRIBUTENAME:"data-baidu-dan-position-fix",TOGGLESTATE_ATTRIBUTE_NAME:"data-player-toggle-state",TOGGLE_STATE_COLLAPSED:"1",TOGGLE_STATE_MAIN:"0",POSITION_CENTER:1,POSITION_BOTTOM_RIGHT:2,POSITION_CENTER_RIGHT:3,POSITION_CENTER_LEFT:4,POSITION_VERTICAL:5,CONTROL_IMG_SRC:"//img.baidu.com/adm/control.gif",LOGO_FLASH_SRC:"//dn.baidu.com/flash/logo_h.swf",LOGO_IMG_SRC:"//dn.baidu.com/images/logo_h.gif",LOGO_URL:"//hong.baidu.com/",CAPTCHA_VCODE_BASE64PLAYER_SRC:"//dn.baidu.com/flash/captcha_vcode.swf",CAPTCHA_UI_IMG_SRC:"//dn.baidu.com/images/captcha.png",COUPLET_UI_IMG_SRC:"//dn.baidu.com/images/couplet.png",SHELL_FLASH:"//dn.baidu.com/flash/shell.swf",HM_JS_URL:"//click.hm.baidu.com/mkt.js",LOG_TYPE_MAP:{ADPOS:"0",IFRAME:"1"},AD_ICON:"https://cpro.baidustatic.com/cpro/ui/noexpire/img/2.0.0/bd-logo08.png",antiCheatUrl:function(t){return t?"//cbjslog.baidu.com/dan_log":""},COLSE_BUTTON_ID:"colse_button_id_",WRAPPER_WIDTH:128,WRAPPER_HEIGHT:303,DEFAULT_OFFSETX:10,LOG_URL:{N:"//gmvl.baidu.com/dan/sp.html",E:"//egmvl.baidu.com/dan/sp.html"},getPlayerId:function(t){return"baidu_dan_player_"+t},getContainerId:function(t){return"baidu_dan_container_"+t},getWrapperId:function(t,e){return e?"baidu_dan_wrapper_"+e+"_"+t:"baidu_dan_wrapper_"+t},getLogoId:function(t){return"baidu_dan_player_logo_"+t},SPAM_LOG_URL:"//cbjslog.baidu.com/dan_log",PRODUCT_TYPE_MAP:{20:"video",21:"video",22:"couplet",23:"barrier",24:"static",25:"expand",26:"null",27:"captcha"},MATERIAL_TYPE_MAP:{20:"video",21:"flash",22:"image",23:"media"}}),oojs.define({name:"flash",namespace:"dup.business.dan.material",deps:{browser:"dup.common.utility.browser",style:"dup.common.utility.style",lang:"dup.common.utility.lang",danConfig:"dup.business.dan.config"},create:function(t,e){var i=e.id,o=e.rcvUrl,n=e.flashHosted,s=e.params||"id="+this.lang.encode(i);n&&(s+="&rcv_url="+this.lang.encode(o));var a=this.getContainer(t,e),r={id:i,playerId:this.danConfig.getPlayerId(i),width:e.width,height:e.height,src:e.src,params:s,isFlash:!0};a.innerHTML=this.createFlash(r),!e.flashHosted&&e.targetUrl&&this.createOverlayAnchor(a,e)},createFlash:function(t){var e;return e=this.browser.ie?'<object type="application/x-shockwave-flash" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" name="baidu_dan_player" '+(t.id?'id="'+t.playerId+'" ':"")+'width="'+t.width+'" height="'+t.height+'" codebase="//fpdownload.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=7,0,0,0"><param name="allowScriptAccess" value="always" ><param name="quality" value="high" ><param name="hasPriority" value="true" ><param name="wmode" value="transparent" ><param name="movie" value="'+t.src+'" >'+(t.params?'<param name="flashvars" value="'+t.params+'" >':"")+"</object>":'<embed wmode="transparent" src="'+t.src+'" quality="high" name="baidu_dan_player" '+(t.id?'id="'+t.playerId+'" ':"")+(t.params?'flashVars="'+t.params+'" ':"")+'width="'+t.width+'" height="'+t.height+'" allowScriptAccess="always" hasPriority="false" type="application/x-shockwave-flash" pluginspage="//www.macromedia.com/go/getflashplayer" >',t.isFlash&&this.danConfig.setStatusMap(t.id,{useObjectForFlash:!0}),e},getContainer:function(t,e){if("expand"!==e.type)return t;var i=document.createElement("ins");i.id="dup_dan_flash_wrap_"+e.id;var o={position:"relative"};return this.style.setStyle(i,o),t.appendChild(i),i},createOverlayAnchor:function(t,e){if(e){var i=document.createElement("a");i.target="_blank",i.href=e.targetUrl;var o=i.style;o.position="absolute",o.zIndex=100,o.top=0,o.display="block",o.left=0,o.width=e.width+"px",o.height=e.height+"px",o.backgroundColor="#fff",o.opacity=0,o.filter="alpha(opacity=0)","outline"in o?o.outline="none":i.hideFocus=!0,t.insertBefore(i,t.firstChild)}}}),oojs.define({name:"createShell",namespace:"dup.business.dan.material",deps:{browser:"dup.common.utility.browser",lang:"dup.common.utility.lang",flash:"dup.business.dan.material.flash",danConfig:"dup.business.dan.config"},create:function(t,e){var i=e.src,o=e.fn||"onLoad",n=""+e.id;n=n.replace("expand_","");var s=["id="+this.lang.encode(n),"fn="+this.lang.encode(o),"src="+this.lang.encode(i)].join("&"),a={id:n,src:this.danConfig.SHELL_FLASH,params:s,flashHosted:e.flashHosted,width:e.width,height:e.height};a.rcvUrl=e.rcvUrl,a.targetUrl=e.targetUrl,this.flash.create(t,a)}}),oojs.define({name:"image",namespace:"dup.business.dan.material",deps:{browser:"dup.common.utility.browser",danConfig:"dup.business.dan.config"},create:function(t,e,i){var o=document.createElement("a");o.id="baidu_dan_a_"+e.id,o.href=e.targetUrl,o.target="_blank",t.appendChild(o);var n=document.createElement("img");n.id=this.danConfig.getPlayerId(e.id),n.width=e.width,n.height=e.height,n.src=e.src,"function"==typeof i&&(n.complete?i():n.onload=function(){n.onload=null,i()}),n.style.display="block",n.style.border=0,o.appendChild(n)}}),oojs.define({name:"video",namespace:"dup.business.dan.material",deps:{flash:"dup.business.dan.material.flash",lang:"dup.common.utility.lang"},create:function(t,e){var i=this.getUserConfig("videoMute"),o=this.getUserConfig("videoVolume"),n=oojs.fastClone(e);n.src=e.playerUrl,n.targetUrl=null,n.params=["player_id="+this.lang.encode(e.id),"play_url="+this.lang.encode(e.src),"target_url="+this.lang.encode(e.targetUrl),"rcv_url="+this.lang.encode(e.rcvUrl),"o_mute="+(i?"1":"0"),"o_volume="+("number"==typeof o?o:"20")].join("&"),this.flash.create(t,n)},getUserConfig:function(t){var e=window.BAIDU_DAN_config||{};return e[t]}}),oojs.define({name:"media",namespace:"dup.business.dan.material",deps:{flash:"dup.business.dan.material.flash"},create:function(t,e){e.flashHosted=!0,this.flash.create(t,e)}}),oojs.define({name:"lib",namespace:"dup.business.dan",deps:{config:"dup.common.config",dom:"dup.common.utility.dom",lang:"dup.common.utility.lang",slot:"dup.business.slot",style:"dup.common.utility.style",danConfig:"dup.business.dan.config",flash:"dup.business.dan.material.flash",viewWatch:"dup.business.viewWatch",event:"dup.common.utility.event",monitor:"dup.business.monitor"},$lib:function(){this.infoCache||(this.infoCache={}),this.requirePositionFix=this.style.canFixed()?null:{}},CENTER_LEFT:0,CENTER_CENTER:1,CENTER_RIGHT:2,centerMode:{},scrollEventRegistered:!1,hasOwn:Object.prototype.hasOwnProperty,positionTracker:[null,"absoluteToCenter","absoluteToBottomRight","absoluteToCenterRight","absoluteToCenterLeft","putToCenterTrans"],absoluteToCenter:function(t,e,i){e=e||t.offsetWidth,i=i||t.offsetHeight;var o=this.getDimension(t);this.style.setStyles(t,{position:"absolute",left:o.scrollLeft-o.bodyOffsetLeft+o.width/2+"px",top:o.scrollTop-o.bodyOffsetTop+o.height/2+"px",marginLeft:(-(e/2)).toFixed()+"px",marginTop:(-(i/2)).toFixed()+"px"})},drawAdIcon:function(t){var e=document.createElement("img");e.src=this.danConfig.AD_ICON,e.style&&(e.style.cssText=["position:absolute;","z-index:"+this.danConfig.MAX_ZINDEX+";","bottom:0;","left:0;","width:52px;","height:21px;"].join(""),t.appendChild(e))},absoluteToBottomRight:function(t,e,i){e=e||t.offsetWidth,i=i||t.offsetHeight;var o=this.getDimension(t);this.style.setStyles(t,{position:"absolute",left:o.scrollLeft+o.width-o.bodyOffsetLeft-e+"px",top:o.scrollTop+o.height-o.bodyOffsetTop-i+"px"})},putToCenterLeft:function(t,e,i,o){this.putToCenter(t,e,this.CENTER_LEFT,0,i,o)},absoluteToCenterRight:function(t,e,i){e=e||t.offsetWidth,i=i||t.offsetHeight;var o=this.getDimension(t);this.style.setStyles(t,{position:"absolute",left:o.scrollLeft+o.width-o.bodyOffsetLeft-e+"px",top:o.scrollTop-o.bodyOffsetTop+(o.height-i)/2+"px"})},absoluteToCenterLeft:function(t,e,i){e=e||t.offsetWidth,i=i||t.offsetHeight;var o=this.getDimension(t);this.style.setStyles(t,{position:"absolute",left:o.scrollLeft-o.bodyOffsetLeft+"px",top:o.scrollTop-o.bodyOffsetTop+(o.height-i)/2+"px"})},putToCenterTrans:function(t,e,i,o){var n=this.centerMode[o].fixMode,s=this.centerMode[o].marginOffset;this.putToCenter(t,o,n,s)},formatInfo:function(t){var e;e=t.pdb_deliv?t.pdb_deliv.deliv_des:t;var i=""+e.id,o=e.id;if(i=i.split("_")[0],!this.infoCache[i]){var n=e.product_type,s=e.material_type;this.infoCache[i]={id:i,rawId:o,urlParameter:e.url_parameter,productType:n,type:this.danConfig.PRODUCT_TYPE_MAP[n],materialType:s,mType:this.danConfig.MATERIAL_TYPE_MAP[s],src:e.src,width:parseInt(e.width,10),height:parseInt(e.height,10),playerUrl:e.player_url,collapseType:e.collapse_type,collapseSrc:e.collapse_src,flashHosted:21==e.product_type,rightType:this.danConfig.MATERIAL_TYPE_MAP[s],rightSrc:e.right_src,rightWidth:parseInt(e.right_width,10),rightHeight:parseInt(e.right_height,10),targetUrl:e.target_url,rcvUrl:e.rcv_url,monitorUrlArray:e.monitor_url,extraJs:e.extra_js,local:e._vlog,hmId:e.hmjsId}}return this.infoCache[i]},isShell:function(t,e){return"flash"===t&&("static"===e||"expand"===e||"couplet"===e)},createContainer:function(t,e,i){var o=document.createElement("ins"),n=o.style;return o.id=this.danConfig.getContainerId(t),n.display="block",n.width=e+"px",n.height=i+"px",n.position="relative",n.overflow="hidden",o},createWrapper:function(t,e){e=this.lang.toArray(e);var i=t.id,o=document.createElement("ins"),n=o.style;o.id=this.danConfig.getWrapperId(i),o.setAttribute(this.danConfig.ID_ATTRIBUTE_NAME,i),o.setAttribute(this.danConfig.TOGGLESTATE_ATTRIBUTE_NAME,this.danConfig.TOGGLE_STATE_MAIN),n.display="block",n.position="relative",n.textDecoration="none",n.width=t.width+"px",n.height=t.height+"px";for(var s=0,a=e.length;a>s;s++)o.appendChild(e[s]);return o},createLogo:function(t,e){var i,o=this.danConfig.getWrapperId("logo_"+e.id);if(!this.dom.g(o))if("couplet"===e.type){i=document.createElement("a"),i.id=o,i.href=this.danConfig.LOGO_URL,i.target="_blank",t.appendChild(i);var n={position:"absolute",zIndex:this.danConfig.MAX_ZINDEX,left:"5px",bottom:"3px",height:"17px",width:"12px",overflow:"hidden",background:"url("+this.danConfig.LOGO_IMG_SRC+") no-repeat 0px 0px"},s=i.style;"outline"in s?s.outline="none":i.hideFocus=!0,this.style.setStyles(i,n)}else{i=document.createElement("div"),i.id=this.danConfig.getWrapperId("logo_"+e.id),t.appendChild(i);var a={position:"absolute",zIndex:this.danConfig.MAX_ZINDEX,bottom:"0px",height:"23px",right:"4px"};this.style.setStyles(i,a);var r="logo_"+e.id,d=(e.params||"id="+e.id)+"&logoId="+r;this.flash.create(i,{id:r,width:"18",height:"23",src:this.danConfig.LOGO_FLASH_SRC,params:d});var l=(this.dom.g(this.danConfig.getPlayerId(r)),this),h=!1;this.event.bind(i,"mouseenter",function(t){var o=t||window.event,n=o.srcElement||o.target;n.id.toLowerCase()===l.danConfig.getWrapperId("logo_"+e.id)&&(h=!0,setTimeout(function(){h&&(i.childNodes[0].setAttribute("width","85"),i.style.right="0")},100))}),this.event.bind(i,"mouseleave",function(t){var o=t||window.event,n=o.srcElement||o.target;n.id.toLowerCase()===l.danConfig.getWrapperId("logo_"+e.id)&&(h=!1,i.innerHTML=l.flash.createFlash({id:r,playerId:l.danConfig.getPlayerId(r),width:"18",height:"23",src:l.danConfig.LOGO_FLASH_SRC,params:d}),i.style.right="4px")}),this.event.bind(i,"mouseup",function(){window.open(l.danConfig.LOGO_URL)})}},destroyAd:function(t){var e=this.dom.g(this.danConfig.getWrapperId(t.id));return e.style.display="none",setTimeout(function(){e.parentNode.removeChild(e)},0),!1},getUserConfig:function(t){var e=window.BAIDU_DAN_config||{};return e[t]},setToggleState:function(t,e){this.infoCache[t].toggleState=e},getToggleState:function(t){return this.infoCache[t].toggleState||(this.infoCache[t].toggleState=this.danConfig.TOGGLE_STATE_MAIN),this.infoCache[t].toggleState},getWrapperId:function(t,e){return e?"baidu_dan_wrapper_"+e+"_"+t:"baidu_dan_wrapper_"+t},isFloat:function(t){var e=t.type;return"video"===e||"barrier"===e||"couplet"===e},putToCenter:function(t,e,i,o,n,s){var a=["left","center","right"];if(this.centerMode[e]={fixMode:i,marginOffset:o},n?this.style.setStyles(t,{width:n+"px",height:s+"px"}):(n=t.offsetWidth,s=t.offsetHeight),this.requirePositionFix)this.absoluteToAnyCenter(t,e,i,o,n,s),e&&(this.requirePositionFix[e]=t);else{var r={position:"fixed",top:"50%",marginTop:(-(s/2)).toFixed()+"px"};1===i?(r.left="50%",r.marginLeft=(-(n/2)).toFixed()+"px"):r[a[i]]=o+"px",this.style.setStyles(t,r)}},centerToWindow:function(t,e,i,o){this.putToCenter(t,e,this.CENTER_CENTER,0,i,o)},putToCenterRight:function(t,e,i,o){this.putToCenter(t,e,this.CENTER_RIGHT,0,i,o)},putToBottomRight:function(t,e,i,o){i?this.style.setStyles(t,{width:i+"px",height:o+"px"}):(i=t.offsetWidth,o=t.offsetHeight),this.requirePositionFix?(this.absoluteToBottomRight(t,i,o),e&&(this.requirePositionFix[e]=t)):this.style.setStyles(t,{position:"fixed",bottom:0,right:0})},absoluteToBottomRight:function(t,e,i){e=e||t.offsetWidth,i=i||t.offsetHeight;var o=this.getDimension(t);this.style.setStyles(t,{position:"absolute",left:o.scrollLeft+o.width-o.bodyOffsetLeft-e+"px",top:o.scrollTop+o.height-o.bodyOffsetTop-i+"px"})},absoluteToAnyCenter:function(t,e,i,o,n,s){n=n||t.offsetWidth,s=s||t.offsetHeight;var a=this.getDimension(t),r={position:"absolute",top:a.scrollTop+(a.height-s)/2-a.bodyOffsetTop+"px"};0===i&&(r.left=a.scrollLeft-a.bodyOffsetLeft+o+"px"),2===i&&(r.left=a.scrollLeft+a.width-a.bodyOffsetLeft-n-o+"px"),1===i&&(r.left=a.scrollLeft-a.bodyOffsetLeft+a.width/2+"px",r.marginLeft=(-(n/2)).toFixed()+"px"),this.style.setStyles(t,r)},getDimension:function(t){var e,i=this.dom.getWindow(t),o=i.document,n="CSS1Compat"!==document.compatMode;this.root=n?o.body:o.documentElement;var s,a=t&&t.style,r=0,d=0;return this.requirePositionFix&&!n&&(s=document.body.style.position||(document.body.currentStyle?document.body.currentStyle.position:""),"relative"!==s&&"absolute"!==s||(r=document.body.offsetLeft||0,d=document.body.offsetTop||0)),a&&(a.top="0",a.left="0"),e={width:this.root.clientWidth,height:this.root.clientHeight,scrollLeft:window.pageXOffset||this.root.scrollLeft,scrollTop:window.pageYOffset||this.root.scrollTop,bodyOffsetLeft:r,bodyOffsetTop:d}},setPositionTrackingMode:function(t,e){this.requirePositionFix&&t.setAttribute(this.danConfig.POSITION_FIX_ATTRIBUTENAME,e)},applyPositionFix:function(){var t=0;for(var e in this.requirePositionFix){if(!this.hasOwn.call(this.requirePositionFix,e))return;t++;var i=this.requirePositionFix[e],o=i.lastChild.offsetWidth?i.lastChild:i.firstChild,n=o.getAttribute(this.danConfig.POSITION_FIX_ATTRIBUTENAME);if(n){var s=this;!function(t,e,i){setTimeout(function(){var o=s.positionTracker[i];s[o](t,0,0,e)},0)}(i,e,n)}}0==t?(this.scrollEventRegistered=!1,this.event.unBind(window,"scroll",oojs.proxy(this,this.applyPositionFix)),this.event.unBind(window,"resize",oojs.proxy(this,this.applyPositionFix))):this.scrollEventRegistered||(this.scrollEventRegistered=!0,this.event.bind(window,"scroll",oojs.proxy(this,this.applyPositionFix)),this.event.bind(window,"resize",oojs.proxy(this,this.applyPositionFix)))},execFuncList:function(t,e,i){i=[].slice.call(arguments,2);for(var o=!0,n=0,s=t.length;s>n;n++)if(t[n]&&"function"==typeof t[n]&&t[n].apply(null,i)===!1){o=!1;break}e&&e(o)},getRootElementSize:function(t,e){var i;if(e){var o=this.dom.getNotCrossDomainWin();i=o.document}else i=t.ownerDocument;var n="CSS1Compat"!==i.compatMode,s=n?i.body:i.documentElement;return{element:s,height:s.clientHeight,width:s.clientWidth,left:s.clientLeft,top:s.clientTop}},getRelativePosition:function(t,e){return t.left>=e.left&&t.top>=e.top&&t.right<=e.width&&t.bottom<=e.height},getElementQuadrant:function(t,e){var i=1;return t.left<e.width/2&&(i|=1),t.top>e.height/2&&(i|=2),i=(i>2?1^i:i)+1}}),oojs.define({name:"logService",namespace:"dup.business.dan",deps:{config:"dup.common.config",dom:"dup.common.utility.dom",lib:"dup.business.dan.lib",danConfig:"dup.business.dan.config",lang:"dup.common.utility.lang",log:"dup.common.utility.log",url:"dup.common.utility.url"},sendLog:function(t){this.log.sendLogRequest(t)},sendPlayerLog:function(t,e){var i=this.lib.getToggleState(t.id)||0,o=+new Date,n=t.urlParameter,s=t.productType,a=this.danConfig.LOG_URL[t.local]+"?"+n+"&tm="+this.lang.encode(o)+"&l="+e.playerDuration+"&m="+e.playerActionCount+"&alp="+e.playerLogPauseCount+"&alr="+e.playerLogReplayCount+"&alrs="+e.playerLogRestoreCount+"&alm="+e.playerLogMuteCount+"&allc="+e.playerLogLargeCloseCount+"&alsc="+e.playerLogSmallCloseCount+"&als="+e.playerLogSearchCount+"&tgs="+i+"&ssp=1&pt="+s;return this.log.sendLogRequest(a),!0},sendMonitorLog:function(t){var e=this.url.getMainDomain(),i=t.monitorUrlArray;if(i instanceof Array&&i.length)for(var o=0;o<i.length;o++){var n=i[o];n=n.replace(/\{placement\\}/g,e),this.log.sendLogRequest(n)}},sendShowLog:function(t){var e=+new Date,i=t.urlParameter,o=t.productType,n=this.danConfig.LOG_URL[t.local]+"?"+i+"&tm="+this.lang.encode(e)+"&pt="+this.lang.encode(o)+"&ssp=1";return this.log.sendLogRequest(n),!0},sendAntiLog:function(t,e){var i=(this.dom.g(this.danConfig.getWrapperId(t.id)),this.lib.getToggleState(t.id));i||(i=0);var o="CSS1Compat"!==document.compatMode,n=this.danConfig.SPAM_LOG_URL+"?"+["ty="+this.danConfig.LOG_TYPE_MAP.ADPOS,"di="+t.id,t.urlParameter,"pt="+t.productType,"tgs="+i,"l="+e.count,"c="+e.code,"x="+e.offsetX,"y="+e.offsetY,"q="+(o?1:0),"ssp=1","tm="+ +new Date].join("&");this.log.sendLogRequest(n)}}),oojs.define({name:"antiCheat",namespace:"dup.business.dan",deps:{config:"dup.common.config",dom:"dup.common.utility.dom",slot:"dup.business.slot",style:"dup.common.utility.style",lib:"dup.business.dan.lib",danConfig:"dup.business.dan.config",viewWatch:"dup.business.viewWatch",log:"dup.business.dan.logService",lang:"dup.common.utility.lang",event:"dup.common.utility.event",monitor:"dup.business.monitor"},$antiCheat:function(){this.antiInfo=this.antiInfo||{},this.iframeStatue=this.iframeStatue||{}},bank:function(){},iframeCheckList:[{key:"checkInIframe",value:function(t){var e=this.buildIframeInfo(t),i=this.isInIframe();return i?(e.code|=1,!0):!1}},{key:"checkInCrossDomainIframe",value:function(t){var e=this.buildIframeInfo(t),i=this.isInCrossDomainIframe();i&&(e.code|=2)}},{key:"checkIframeSize",value:function(t){for(var e,i,o,n,s=this.buildIframeInfo(t),a=this.dom.getWinList(),r=window.top,d=0,l=a.length;l>d&&(e=a[d],e!==r);d++){i=e.document,n="CSS1Compat"!==i.compatMode,o=n?i.body:i.documentElement;var h=o.clientWidth,c=o.clientHeight;if((h<t.width||c<t.height)&&(s.code|=4),h>2*t.width&&c>2*t.height&&(s.code|=8),h>100&&c>100&&(s.code|=16),28===(28&s.code))break}}},{key:"checkIframeVisible",value:function(t){for(var e,i=this.buildIframeInfo(t),o=this.dom.getWinList(),n=0,s=o.length-1;s>n;n++)if(e=o[n],e.frameElement&&!this.style.isVisible(e.frameElement)){i.code|=32;break}}},{key:"checkIframeMove",value:function(t){var e=this.buildIframeInfo(t),i=this.dom.getWinList();if(!(i.length<2)){var o=i[0].frameElement,n=this.checkPosition(t,o);n.isXMove&&(e.offsetX=n.xMove,e.code|=64),n.isYMove&&(e.offsetY=n.yMove,e.code|=128),n.isIframeInScreen||(e.code|=256)}}}],buildAntiInfo:function(t){var e=t.id;if(!this.antiInfo[e]){var i=t.type;this.antiInfo[e]={isStatic:"static"===i||"expand"===i,code:0,offsetX:0,offsetY:0,intervalId:0,intervalTime:12e3,count:0}}return this.antiInfo[e]},buildIframeInfo:function(t){var e=t.id;return this.iframeStatue[e]||(this.iframeStatue[e]={checked:!1,code:0,offsetX:0,offsetY:0}),this.iframeStatue[e]},isHit:function(t){return(292&t.code)>0},notifyAntiCheck:function(t,e){var i=this.buildAntiInfo(t);if("stop"===e&&clearInterval(i.intervalId),"start"===e&&!i.intervalId){this.sendCheckAdposLog(t);var o=this;i.intervalId=setInterval(function(){o.sendCheckAdposLog(t)},i.intervalTime)}},check:function(t){if(!this.iframeStatue.checked){this.execFuncList(this.iframeCheckList,this.bank,t);var e=this.iframeStatue[t.id],i=this.danConfig.SPAM_LOG_URL+"?"+["ty="+this.danConfig.LOG_TYPE_MAP.IFRAME,"ssp=1","di="+t.id,t.urlParameter,"pt="+t.productType,"if="+e.code,"x="+e.offsetX,"y="+e.offsetY,"ib="+(this.isHit(e)?1:0),"ir="+this.lang.encode(this.getIframeReferrer()),"tm="+ +new Date].join("&");this.log.sendLog(i),this.iframeStatue.checked=!0}},execFuncList:function(t,e,i){i=[].slice.call(arguments,2);for(var o=!0,n=0,s=t.length;s>n;n++){var a=oojs.proxy(this,t[n].value);if(a&&"function"==typeof a&&a.apply(null,i)===!1){o=!1;break}}e&&e(o)},antiFrameStart:function(t){var e=!0,i=this.iframeStatue;return"video"===t.type&&(this.check(t),this.isHit(i)&&(e=!1)),e},getIframeReferrer:function(){if(!this.dom.isInIframe())return"";var t=this.dom.getNotCrossDomainTopWindow();return t===window.top?t.document.location.href:t.document.referrer||t.document.location.href},sendCheckAdposLog:function(t){var e=this.buildAntiInfo(t);if(e.count++>=5)return void clearInterval(e.intervalId);try{this.checkAdRemove(t)&&(this.checkAdMove(t),this.checkAdshow(t),this.checkAdMaterial(t))}catch(i){clearInterval(e.intervalId)}},checkAdRemove:function(t){var e=this.buildAntiInfo(t);return this.isRemove(t)?(e.code|=1,!1):!0},isRemove:function(t){var e=this.dom.g(this.danConfig.getWrapperId(t.id)),i=this.dom.g(this.danConfig.getContainerId(t.id)),o=this.dom.g(this.danConfig.getPlayerId(t.id));return!e||!i||!o},checkPosition:function(t,e){if(e.getBoundingClientRect){var i=e.getBoundingClientRect(),o=e.ownerDocument,n="CSS1Compat"!==o.compatMode,s=n?o.body:o.documentElement,a=s.clientHeight,r=s.clientWidth,d=s.clientLeft,l=s.clientTop;if("video"===t.type){var h=i.right-r-d,c=i.bottom-a-l;return{isXMove:Math.abs(h)>1,isYMove:Math.abs(c)>1,xMove:h,yMove:c,isInScreen:i.left>=d&&i.top>=l&&1>=h&&1>=c,isIframeInScreen:i.right-d>=t.width&&i.bottom-l>=t.height&&1>=h&&1>=c}}return{isXMove:!1,isYMove:!1,xMove:i.left,yMove:i.top,isInScreen:i.left>=d&&i.top>=l&&i.right<=r&&i.bottom<=a,isIframeInScreen:i.right-d>=t.width&&i.bottom-l>=t.height&&r-i.left+d>=t.width&&a-i.top+l>=t.height}}return{isXMove:!1,isYMove:!1,xMove:0,yMove:0,isInScreen:!0,isIframeInScreen:!0}},checkAdMove:function(t){var e=this.buildAntiInfo(t);if(this.lib.getToggleState(t.id)===this.danConfig.TOGGLE_STATE_MAIN||e.isStatic){var i=this.dom.g(this.danConfig.getPlayerId(t.id)),o=this.checkPosition(t,i);o.isXMove&&(e.offsetX=o.xMove,e.code|=2),o.isYMove&&(e.offsetY=o.yMove,e.code|=4),o.isInScreen||(e.code|=8)}},checkAdshow:function(t){for(var e,i,o=this.buildAntiInfo(t),n=this.dom.g(this.danConfig.getPlayerId(t.id)),s=this.style.getDefaultStyle,a=n;a&&a!==document&&a!==document.body&&a!==document.documentElement;a=a.parentNode){if(!this.style.isVisible(a)){o.code|=32;break}if((this.lib.getToggleState(t.id)===this.danConfig.TOGGLE_STATE_MAIN||o.isStatic)&&(e=a.offsetWidth||a.clientWidth,i=a.offsetHeight||a.clientHeight,e<t.width&&"hidden"===s(a,"overflowX")||i<t.height&&"hidden"===s(a,"overflowY"))){o.code|=16;break}}},checkAdMaterial:function(t){var e,i=this.buildAntiInfo(t),o=this.dom.g(this.danConfig.getPlayerId(t.id)),n="video"===t.mType?t.playerUrl:t.src;if(this.danConfig.statusMap[t.id]&&"image"!==t.mType){for(var s,a=0;a<o.childNodes.length;a++)if(s=o.childNodes[a],"movie"===s.getAttribute("name")&&(e=s.getAttribute("value"),e!=n&&e!=this.danConfig.SHELL_FLASH)){i.code|=64;break}}else e=o.getAttribute("src"),e!=n&&e!=this.danConfig.SHELL_FLASH&&(i.code|=64)},isInIframe:function(){return!(window==window.top||window==window.parent)},isInCrossDomainIframe:function(){return this.dom.getNotCrossDomainWin()!=window.top}}),oojs.define({name:"ad",namespace:"dup.business.dan",deps:{dom:"dup.common.utility.dom",slot:"dup.business.slot",style:"dup.common.utility.style",lib:"dup.business.dan.lib",BrandLoader:"dup.business.dan.BrandLoader",log:"dup.business.dan.logService",danConfig:"dup.business.dan.config",antiCheat:"dup.business.dan.antiCheat",viewWatch:"dup.business.viewWatch",event:"dup.common.utility.event",monitor:"dup.business.monitor"},shownIds:{},show:function(t){var e=t.id;if(!this.shownIds[e]){this.shownIds[e]=!0;var i=(t.type,t.mType);t=this.lib.formatInfo(t),this.log.sendMonitorLog(t),"video"!==i&&this.log.sendShowLog(t);var o=this.BrandLoader;o.config(t),o.start();var n=oojs.using("dup.ui.painter.dan."+t.type);n&&n.show&&n.show(t)}},startAntiCheck:function(t){this.antiCheat.notifyAntiCheck(t,"start")},stopAntiCheck:function(t){this.antiCheat.notifyAntiCheck(t,"stop")}}),oojs.define({name:"materSelect",namespace:"dup.business.dan.material",deps:{config:"dup.common.config",dom:"dup.common.utility.dom",slot:"dup.business.slot",antiCheat:"dup.business.dan.antiCheat",browser:"dup.common.utility.browser",requestCache:"dup.business.requestCache",lib:"dup.business.dan.lib",ad:"dup.business.dan.ad",danConfig:"dup.business.dan.config",flash:"dup.business.dan.material.flash",shell:"dup.business.dan.material.createShell",image:"dup.business.dan.material.image",video:"dup.business.dan.material.video",media:"dup.business.dan.material.media"},create:function(t,e){this.danConfig.setStatusMap(e.id,{useObjectForFlash:!1});var i=e.mType,o=e.type;if(this.lib.isShell(i,o)?this.shell.create(t,e):this.otherSelect(t,e,i),e.hmId){var n=this.dom.g(this.danConfig.getWrapperId(e.id)),s=n.parentNode;if(s){var a=document.createElement("ins");a.id="_bdhm_mkt_"+e.hmId,s.insertBefore(a,n.nextSibling),this.requestCache.loadScript(this.danConfig.HM_JS_URL+"?"+e.hmId)}}if(e.extraJs){var r=document.createElement("script");r.src=e.extraJs,r.type="text/javascript",t.appendChild(r)}},otherSelect:function(t,e,i,o){switch(i){case"media":this.media.create(t,e);break;case"flash":this.flash.create(t,e);break;case"image":this.image.create(t,e,o);break;case"video":this.video.create(t,e);break;default:return}if(e.hmId){var n=this.dom.g(this.danConfig.getWrapperId(e.id)),s=n.parentNode;if(s){var a=document.createElement("ins");a.id="_bdhm_mkt_"+e.hmId,s.insertBefore(a,n.nextSibling),this.requestCache.loadScript(this.danConfig.HM_JS_URL+"?"+e.hmId)}}}}),oojs.define({name:"static",namespace:"dup.ui.painter.dan",deps:{config:"dup.common.config",dom:"dup.common.utility.dom",slot:"dup.business.slot",style:"dup.common.utility.style",lib:"dup.business.dan.lib",ad:"dup.business.dan.ad",getMaterial:"dup.business.dan.material.materSelect",danConfig:"dup.business.dan.config",viewWatch:"dup.business.viewWatch",event:"dup.common.utility.event",monitor:"dup.business.monitor"},validate:function(t){return t.id?!0:void 0},render:function(t){this.slot.setStatus(t.id,this.config.STATUS_RENDERED);var e=t.response,i=this.lib.formatInfo(e);if(i&&this.validate(t)){this.monitor.sendLog(t);var o=this.dom.g(t.containerId);o&&(this.create(i,o),this.ad.show(i),this.viewWatch.regisetViewWatch(t),this.slot.setStatus(t.id,this.config.STATUS_FINISH))}},create:function(t,e){var i=this.dom.g(e);if(i){var o=t.id,n=this.lib.createContainer(o,t.width,t.height),s=this.lib.createWrapper(t,n),a=this.lib.getUserConfig("zIndex");this.style.setStyle(s,"z-index",a),i.style.display="",i.appendChild(s),this.getMaterial.create(n,t),this.lib.createLogo(s,t),this.lib.drawAdIcon(s)}}});})(_ssp_global.oojs);